<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>알림 예약</title>
</head>
<body>
  <h1>2025.09.12 - 오후 4시 10분 알림 예약</h1>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        console.log('서비스 워커 등록 완료:', reg);

        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            // 사람이 읽기 쉬운 형식 → 날짜 객체로 변환
            const dateString = "2025.09.12-pm4:12";
            const [datePart, timePart] = dateString.split('-');
            const [year, month, day] = datePart.split('.').map(Number);

            let hour = parseInt(timePart.match(/\d+/)[0], 10);
            const minute = parseInt(timePart.split(':')[1], 10);
            if (timePart.includes('pm') && hour < 12) hour += 12;

            const target = new Date();
            target.setFullYear(year);
            target.setMonth(month - 1); // JS는 0부터 시작
            target.setDate(day);
            target.setHours(hour);
            target.setMinutes(minute);
            target.setSeconds(0);
            target.setMilliseconds(0);

            const now = new Date();
            const delay = target.getTime() - now.getTime();

            if (delay > 0) {
              setTimeout(() => {
                reg.active.postMessage('showNotification');
              }, delay);
            } else {
              console.log('이미 시간이 지났습니다.');
            }
          }
        });
      });
    }
  </script>
</body>
</html>
